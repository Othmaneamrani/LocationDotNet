@using BLL.Representation;
@using Newtonsoft.Json;
@using System.Security.Claims;

<partial name="navbarLogin"  />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@1,9..144,200&family=Gluten:wght@200&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

@{
    VehiculeRepresentation vehicule = ViewBag.vehicule;
}


@if (vehicule == null)
{
    <p>Aucun Véhicule trouvé.</p>
}
else
{

    <h2 class="titre">Details</h2>

    @if (vehicule.promoRepresentation.Equals("Non"))
    {
        <div class="col-md-6 mb-4 mx-auto text-center">
            <div class="card">
                <div class="row no-gutters">
                    <div class="col-md-6">
                        <img style="height: 118%;width: 116%;" src="@vehicule.photoRepresentation" class="card-img-top" alt="Photo du véhicule">
                    </div>
                    <div class="col-md-6">
                        <div class="card-body">
                            <h5 class="card-title" style="font-size: 2em;">@vehicule.marqueRepresentation.First().ToString().ToUpper()@vehicule.marqueRepresentation.Substring(1)</h5>
                            <p class="text-right">
                                <span class="card-text">@vehicule.prixRepresentation</span>
                                <span class="card-dh">DHs/jour</span>
                            </p>
                            @if (vehicule.typeMoteurRepresentation.Equals("Manuel"))
                            {
                                <span class="card-text">Moteur Manuel</span>

                            }
                            @if (vehicule.typeMoteurRepresentation.Equals("Automatique"))
                            {
                                <span class="card-text">Moteur Automatique</span>

                            }
                            @if (vehicule.estDispoRepresentation.Equals("Oui"))
                            {
                                <span class="card-text">Disponible !</span>

                            }
                            @if (vehicule.estDispoRepresentation.Equals("Non"))
                            {
                                <span class="card-text">Non Disponible</span>

                            }
                            <p class="text-right">
                                <a class="btn btn-primary m-lg-3 mb-3 " asp-controller="Client" asp-action="CommandeUser" asp-route-idVehicule="@vehicule.idRepresentation" >Commander</a>
                                <a id="bien" class="btn btn-primary m-lg-3 mb-3" asp-controller="Client" asp-action="addFav" >
                                    <img src="https://firebasestorage.googleapis.com/v0/b/vehicule-32b2d.appspot.com/o/icons8-heart-94.png?alt=media&token=2924c4c2-9063-48d3-8e80-6333c1bfbc2a" class="heart" alt="heart" />
                                </a>
                                <a id="broke" class="btn btn-primary m-lg-3 mb-3" asp-controller="Client" asp-action="deleteFav" >
                                    <img src="https://firebasestorage.googleapis.com/v0/b/vehicule-32b2d.appspot.com/o/icons8-broken-heart-94.png?alt=media&token=aaa11b3e-e1f9-4723-a03f-e44fafecf516" class="heart" alt="heartBroke" />
                                </a>

                            </p>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
    @if (vehicule.promoRepresentation.Equals("Oui"))
    {
        <div class="col-md-6 mb-4 mx-auto text-center">
            <div class="card">
                <div class="row no-gutters">
                    <div class="col-md-6">
                        <img style="height: 101%;width: 101%;" src="@vehicule.photoRepresentation" class="card-img-top" alt="Photo du véhicule">
                    </div>
                    <div class="col-md-6">
                        <div class="card-body">
                            <h5 style="font-size: 2em;" class="card-title">@vehicule.marqueRepresentation.First().ToString().ToUpper()@vehicule.marqueRepresentation.Substring(1)</h5>
                            <p class="text-right">
                                <span style="float: right;">
                                    <span class="card-text-before">@vehicule.prixRepresentation</span>
                                    <span class="card-dh" style="text-decoration: line-through;">DHs/jour</span>
                                </span>
                            <p></p>
                            <span style="float: right;">
                                <span class="card-text">@vehicule.promoPrixRepresentation</span>
                                <span class="card-dh">DHs/jour</span>
                            </span>
                                @if (vehicule.typeMoteurRepresentation.Equals("Manuel"))
                                {
                                <span class="card-text">Moteur Manuel</span>

                                }
                                @if (vehicule.typeMoteurRepresentation.Equals("Automatique"))
                                {
                                <span class="card-text">Moteur Automatique</span>

                                }
                                @if (vehicule.estDispoRepresentation.Equals("Oui"))
                                {
                                <span class="card-text">Disponible !</span>

                                }
                                @if (vehicule.estDispoRepresentation.Equals("Non"))
                                {
                                <span class="card-text">Non Disponible</span>

                                }

                            <p class="text-right mt-3">
                                <a class="btn btn-primary" style="margin-left:20px;" asp-controller="Client" asp-action="CommandeUser" asp-route-idVehicule="@vehicule.idRepresentation" >Commander</a>
                                <a class="btn btn-primary m-lg-3 mb-3 " id="bien" asp-controller="Client" asp-action="addFav" >
                                    <img src="https://firebasestorage.googleapis.com/v0/b/vehicule-32b2d.appspot.com/o/icons8-heart-94.png?alt=media&token=2924c4c2-9063-48d3-8e80-6333c1bfbc2a" class="heart" alt="heart" />
                                </a>
                                <a class="btn btn-primary m-lg-3 mb-3 " id="broke" asp-controller="Client" asp-action="deleteFav" >
                                    <img src="https://firebasestorage.googleapis.com/v0/b/vehicule-32b2d.appspot.com/o/icons8-broken-heart-94.png?alt=media&token=aaa11b3e-e1f9-4723-a03f-e44fafecf516" class="heart" alt="heartBroke" />
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
}
<a asp-controller="Client" asp-action="Index"  class="btn btn-primary m-lg-3 mb-3 ">Retour</a>
<style>
    .titre {
        font-family: 'Gluten', cursive;
        margin-right: 20px;
        margin-top: 20px;
        margin-bottom: 20px;
        font-weight: bold;
    }

    .card-title {
        font-weight: bold;
        align-items: center;
        text-align: center;
    }

    .card-text {
        font-family: 'Gluten', cursive;
        font-size: 1.3em;
        font-weight: bold;
    }

    .card-dh {
        font-family: 'Gluten', cursive;
    }

    .card {
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        transition: box-shadow 0.3s ease-in-out;
        margin-bottom: 40px;
        margin-top: 70px;
        height: 700px;
    }

        .card:hover {
            box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        }

    .card-text-before {
        font-family: 'Gluten', cursive;
        font-size: 1em;
        font-weight: bold;
        text-decoration: line-through;
    }

    .card-body {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 100%;
    }

    .heart{
        width: 25px;
        height: 25px;
    }
</style>


<script>
    var compteId = " @User.FindFirstValue(ClaimTypes.NameIdentifier)";
    var vehiculeId = "@vehicule.idRepresentation";

    $.ajax({
        url: "/Client/getFavoris",
        type: "GET",
        data: {
            compteId: compteId,
            vehiculeId: vehiculeId
        },
        success: function (result) {
            var heartImg = document.getElementById("bien");
            var heartBrokeImg = document.getElementById("broke");

            if (result) {
                heartBrokeImg.style.display = "inline-block";
                heartImg.style.display = "none";
            } else {
                heartImg.style.display = "inline-block";
                heartBrokeImg.style.display = "none";
            }
        },
        error: function (error) {
            console.error("Erreur  : ", error);
        },
        async: false
    });
</script>